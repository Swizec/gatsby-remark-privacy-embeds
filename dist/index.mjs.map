{"version":3,"file":"index.mjs","sources":["../src/index.ts"],"sourcesContent":["import visit from \"unist-util-visit\";\n\ntype PluginOptions = {};\n\nfunction cacheKey(search) {\n    return `giphy-result:${search}`;\n}\n\nasync function getThumbnail(targetUrl) {\n    const url = `https://pifc233qp6.execute-api.us-east-1.amazonaws.com/dev/embed?url=${targetUrl}`;\n\n    const res = await fetch(url).then((res) => res.json());\n\n    return res.url;\n}\n\nasync function embed(linkNode, embedType: \"youtube\") {\n    const originalUrl = linkNode.url;\n    const thumbnailUrl = await getThumbnail(originalUrl);\n\n    if (thumbnailUrl) {\n        linkNode.type = \"image\";\n        linkNode.url = thumbnailUrl;\n        linkNode.title = \"A youtube video\";\n        linkNode.alt = \"A youtube video\";\n        linkNode.children = null;\n        linkNode.properties = {\n            \"data-embed-url\": originalUrl,\n            \"data-embed-type\": embedType,\n        };\n\n        console.log(require(\"util\").inspect(linkNode, false, null, true));\n    }\n\n    return linkNode;\n}\n\nexport default async function (\n    { cache, markdownAST },\n    pluginOptions: PluginOptions\n) {\n    const transformations = [];\n\n    visit(markdownAST, \"link\", (linkNode) => {\n        const url = linkNode.url as string;\n\n        if (url.match(/^http(s)?:\\/\\/(www\\.)?(youtube\\.com|youtu\\.be)/)) {\n            transformations.push(async () => embed(linkNode, \"youtube\"));\n        }\n    });\n\n    await Promise.all(transformations.map((t) => t()));\n\n    return markdownAST;\n}\n"],"names":["pluginOptions","transformations","visit","markdownAST","linkNode","url","match","push","embedType","originalUrl","targetUrl","fetch","then","res","json","getThumbnail","thumbnailUrl","type","title","alt","children","properties","console","log","require","inspect","embed","Promise","all","map","t"],"mappings":"0DAuCIA,+BAEMC,EAAkB,UAExBC,EAAMC,EAAa,gBAASC,GACZA,EAASC,IAEbC,MAAM,mDACVL,EAAgBM,gCA/BPH,EAAUI,WACrBC,EAAcL,EAASC,oCATLK,8BAGNC,8EAFkED,GAEvDE,cAAMC,UAAQA,EAAIC,wBAAzCD,UAECA,EAAIR,yCAKgBU,CAAaN,kBAAlCO,UAEFA,IACAZ,EAASa,KAAO,QAChBb,EAASC,IAAMW,EACfZ,EAASc,MAAQ,kBACjBd,EAASe,IAAM,kBACff,EAASgB,SAAW,KACpBhB,EAASiB,WAAa,kBACAZ,oBAoB+B,WAhBrDa,QAAQC,IAAIC,QAAQ,QAAQC,QAAQrB,GAAU,EAAO,MAAM,KAGxDA,uCAakCsB,CAAMtB,uBAIzCuB,QAAQC,IAAI3B,EAAgB4B,aAAKC,UAAMA,+BAEtC3B"}